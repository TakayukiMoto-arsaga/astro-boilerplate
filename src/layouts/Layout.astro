---
import HeadGTM from '@/layouts/HeadGTM.html'
import '../index.css'

const { head } = Astro.props
const isDisplayMetaRobotsTag = head.robots && head.robots !== 'all'
const headCommon: HeadCommonProps = {
  webSiteName: 'Webサイト全体で共通の文章を書いてください。',
  isFaviconSVG: true,
  xCard: 'summary_large_image',
  xSite: '@xSite',
  isAppleTouchIcon: true,
  themeColor: '#808080',
  fbAppID: '01234567890',
  gtmID: 'GTM-XXXXXXXX',
}

interface HeadCommonProps {
  webSiteName: string // 不要であれば空文字
  isFaviconSVG: boolean // 原則、SVG形式のファビコンも用意
  xCard: 'summary' | 'summary_large_image' | 'app' | 'player' | '' // 不要であれば空文字, 使用するときは'summary_large_image'を推奨, summaryでは画像のアス比が1:1になるので注意
  xSite: `@${string}`
  isAppleTouchIcon: boolean
  themeColor?: string
  fbAppID?: string
  gtmID?: `GTM-${string}` // TODO: headタグの中に指定するGTMのIDは動的な記法がサポートされていないため、ここの値を変更したらそちらも手作業で変更すること
}
---

<!doctype html>
<html lang='ja'>
  <head>
    {/* 必須 */}
    <meta charset='UTF-8' />
    <title>
      {head.title}{headCommon.webSiteName && ' - '}{headCommon.webSiteName}
    </title>
    <meta name='description' content={head.description} />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    {isDisplayMetaRobotsTag && <meta name='robots' content={head.robots} />}
    <meta name='format-detection' content='telephone=no' />
    {
      headCommon.isFaviconSVG && (
        <link rel='icon' href='/favicon.svg' sizes='any' type='image/svg+xml' />
      )
    }
    <link rel='icon' href='/favicon.png' sizes='48x48' />
    <link rel='canonical' href={head.canonical} />

    {/* 必須: OGP */}
    <meta
      property='og:title'
      content={`${head.title}${headCommon.webSiteName ? ' - ' + headCommon.webSiteName : ''}`}
    />
    <meta property='og:description' content={head.description} />
    <meta property='og:type' content={head.ogType} />
    <meta property='og:url' content={head.canonical} />
    <meta property='og:image' content={head.ogImage} />
    <meta property='og:image:width' content='1200' />
    <meta property='og:image:height' content='630' />
    <meta property='og:image:alt' content={head.ogImageAlt} />
    <meta property='og:site_name' content={headCommon.webSiteName} />
    <meta property='og:locale' content='ja_JP' />

    {/* 任意: X Card */}
    {
      headCommon.xCard && (
        <>
          <meta name='twitter:card' content={headCommon.xCard} />
          <meta
            name='twitter:title'
            content={`${head.title}${headCommon.webSiteName ? ' - ' + headCommon.webSiteName : ''}`}
          />
          <meta name='twitter:description' content={head.description} />
          <meta name='twitter:image:alt' content={head.ogImageAlt} />
          <meta name='twitter:url' content={head.canonical} />
        </>
      )
    }
    {
      headCommon.xSite && (
        <meta name='twitter:site' content={headCommon.xSite} />
      )
    }
    {head.xCreator && <meta name='twitter:creator' content={head.xCreator} />}

    {/* 任意 */}
    {head.author && <meta name='author' content={head.author} />}
    {
      headCommon.isAppleTouchIcon && (
        <link
          rel='apple-touch-icon'
          sizes='180x180'
          href='/apple-touch-icon.png'
        />
      )
    }
    {
      headCommon.themeColor && (
        <meta name='theme-color' content={headCommon.themeColor} />
      )
    }
    {
      headCommon.webSiteName && (
        <meta name='application-name' content={headCommon.webSiteName} />
      )
    }
    {
      head.googleSiteVerification && (
        <meta
          name='google-site-verification'
          content={head.googleSiteVerification}
        />
      )
    }
    {
      headCommon.fbAppID && (
        <meta property='fb:app_id' content={headCommon.fbAppID} />
      )
    }
    <meta name='generator' content={Astro.generator} />

    {/* Google Tag Manager */}
    {/* 直書きだとコードを整形してくれなかったので、コンポーネント化 */}
    {/* gtmIDを変更するときは、HeadGTMの方も変更すること */}
    {
      /* 開発者ツールでHTMLを見ると、headタグの直上になぜかGTMの一部のコードが表示 */
    }
    {headCommon.gtmID && <HeadGTM />}
  </head>

  <body>
    {/* Google Tag Manager(noscript) */}
    {
      headCommon.gtmID && (
        <noscript>
          <iframe
            src={`https://www.googletagmanager.com/ns.html?id=${headCommon.gtmID}`}
            height='0'
            width='0'
            style='display: none; visibility: hidden'
            title='Google Tag Manager'
            loading='lazy'
          />
        </noscript>
      )
    }
    <slot />
  </body>
</html>
